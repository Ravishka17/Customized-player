<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Custom Video Player</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="https://player-html-drab.vercel.app/styles.css">
  <style>
    /* Base styles */
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      user-select: none;
    }

    .video-container {
      position: relative;
      width: 382px; /* Mobile view width */
      height: 250px; /* Mobile view height */
      background-color: #000;
      overflow: hidden;
    }

    .preview {
      position: absolute;
      bottom: 100px; /* Position it above the progress bar */
      left: 0;
      width: 150px; /* Set the width of the preview thumbnail */
      height: 90px; /* Set the height of the preview thumbnail */
      background: rgba(0, 0, 0, 0.5);
      background-size: cover;
      display: none; /* Hide it by default */
      z-index: 3;
    }

    .preview-time {
      position: absolute;
      bottom: 75px; /* Position it under the preview thumbnail */
      left: 0;
      width: 50px;
      text-align: center;
      background: rgba(0, 0, 0, 0.7);
      color: #fff;
      font-size: 12px;
      display: none;
      z-index: 4;
    }

    video {
      width: 100%;
      height: 100%;
      object-fit: cover; /* Cover the entire container */
      display: block;
    }

    /* Progress Bar */
    .progress-bar {
      position: absolute;
      bottom: 50px;
      width: calc(100% - 30px);
      left: 15px;
      height: 5px;
      background: rgba(85, 85, 85, 0.5);
      cursor: pointer;
      backdrop-filter: blur(5px); /* semi-transparent background */
    }

    .progress-bar div {
      height: 100%;
      width: 0;
      background: #f39c12;
    }

    /* Bottom Controls */
    .controls {
      position: absolute;
      bottom: 0;
      left: 15px;
      right: 15px;
      width: calc(100% - 30px);
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: transparent;
      color: #f39c12;
      z-index: 2;
      padding-right: 10px;
    }

    /* Fullscreen Left and Right Controls */
    .fullscreen-left-controls,
    .fullscreen-right-controls {
      display: none;
      align-items: center;
      background: transparent;
      color: #f39c12;
      z-index: 2;
      padding-right: 10px;
    }

    /* Hide controls initially */
    .controls,
    .fullscreen-left-controls,
    .fullscreen-right-controls,
    .progress-bar,
    .center-controls {
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .video-container.show-controls .controls,
    .video-container.show-controls .fullscreen-left-controls,
    .video-container.show-controls .fullscreen-right-controls,
    .video-container.show-controls .progress-bar,
    .video-container.show-controls .center-controls {
      opacity: 1;
    }

    .controls button,
    .controls a {
      background: none;
      border: none;
      color: #f39c12;
      font-size: 25px;
      cursor: none;
      text-decoration: none;
    }

    .controls button svg,
    .controls a svg {
      width: 30px; /* Set the desired width */
      height: 30px; /* Set the desired height */
      fill: #f39c12;
    }

    .time {
      min-width: 100px;
    }
    
    .center-controls {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      display: flex;
      align-items: center;
      gap: 40px;
      z-index: 2;
      opacity: 1;
    }

    .loading-spinner {
      display: none;
      width: 48px;
      height: 48px;
      border: 5px solid #f39c12; /* Loader color */
      border-bottom-color: transparent; /* Transparent section */
      border-radius: 50%;
      box-sizing: border-box;
      animation: rotation 1s linear infinite; /* Smooth spin */
    }

   .center-controls button {
     background: transparent;
     border: none;
     fill: #f39c12;
     font-size: 38px;
     cursor: none;
     transition: background 0.3s ease;
   }

    .center-controls button svg {
      height: 50px;
      width: 50px;
    }
    
    #fullscreen {
      font-size: 40px;
    }

    /* Rotation animation */
    @keyframes rotation {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    /* Only show the play button initially */
    #rewind,
    #forward {
      display: none;
    }

    /* Fullscreen mode fixes */
    .video-container:fullscreen .controls {
      display: none;
    }

    .video-container:fullscreen .fullscreen-left-controls,
    .video-container:fullscreen .fullscreen-right-controls {
      display: flex;
    }

    .video-container:fullscreen .fullscreen-left-controls {
      position: absolute;
      bottom: 5px;
      left: 15px;
      right: auto;
      width: auto;
      justify-content: flex-start;
    }

    .video-container:fullscreen .fullscreen-right-controls {
      position: absolute;
      bottom: 5px;
      right: 15px;
      left: auto;
      width: auto;
      justify-content: flex-end;
    }

    .video-container:fullscreen .fullscreen-left-controls button,
    .video-container:fullscreen .fullscreen-right-controls button {
      margin: 0 5px;
      font-size: 30px;
      color: #f39c12;
    }

    /* Increase size of center control buttons in fullscreen mode */
    .video-container:fullscreen .center-controls button {
      font-size: 100px; /* Increase icon size */
    }

    .video-container:fullscreen .center-controls {
      gap: 100px;
    }

    .video-container:fullscreen .center-controls button i {
      font-size: 80px; /* Increase icon size */
    }

    /* Adjust progress bar size in fullscreen mode */
    .video-container:fullscreen .progress-bar {
      bottom: 55px; /* Adjust position */
      height: 6px; /* Adjust height */
      width: calc(100% - 30px);
      left: 15px;
    }

    /* Adjust time display size in fullscreen mode */
    .video-container:fullscreen .time {
      font-size: 20px; /* Adjust font size */
    }

    /* Adjust download button size in fullscreen mode */
    .video-container:fullscreen .controls a {
      font-size: 30px; /* Adjust font size */
    }

    /* Settings Menu */
    .settings-menu {
      position: absolute;
      top: 1%;
      right: 5%;
      background-color: #333;
      color: white;
      width: 250px;
      height: 190px;
      display: none;
      z-index: 1000;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
      overflow-y: auto;
      border-bottom: 1px solid #555;
      user-select: none;
    }

    /* Toolbar Header */
    .settings-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #222;
      padding-top: 10px;
      border-bottom: 1px solid #555;
      position: sticky; /* Keeps header fixed */
      top: 0;
      z-index: 10;
    }

    .settings-header button {
      background: none;
      border: none;
      color: white;
      font-size: 14px;
      user-select: none;
    }

    .settings-header button.active {
      border-bottom: 2px solid #f39c12;
      font-weight: bold;
    }

    .close-settings {
      color: white;
      font-size: 16px;
      margin-right: 10px;
      user-select: none;
    }

    /* Content Area */
    .settings-body {
      height: calc(100% - 40px); /* Takes all available height minus header */
      background-color: #333;
      padding: 10px 5px;
    }

    /* Tabs */
    .settings-tab {
      display: none;
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .settings-tab li {
      margin-left: 25px;
      padding: 8px;
      position: relative;
    }

    .settings-tab li.selected::before {
      content: '\F309'; /* This is just a placeholder. Use the correct unicode for your Bootstrap icon */
      font-family: 'bootstrap-icons';
      color: #f39c12;
      position: absolute;
      font-size: 30px;
      margin-left: -30px;
      top: 2px;
    }

    .settings-tab.active-tab {
      display: block;
    }

    .settings-body {
      -webkit-overflow-scrolling: touch; /* Smooth scrolling for iOS */
    }

    /* Error message */
    .error-message {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255, 0, 0, 0.8);
      fill: white;
      padding: 10px;
      border-radius: 10px;
      text-align: center;
      z-index: 10;
      display: none;
    }

    .error-message svg {
      width: 40px;
      higth: 40px;
      margin-bottom: 5px;
    }

    /* Fullscreen mode specific styles */
    .video-container:fullscreen .settings-menu {
      top: 7%;
      width: 400px;
      height: 300px;
    }

    /* Media query for larger screens (desktop) */
    @media (min-width: 768px) {
      .video-container {
        width: 1200px; /* Desktop view width */
        height: 800px; /* Desktop view height */
      }

      /* Increase size of progress bar */
      .progress-bar {
        bottom: 110px; /* Move it up a bit */
        height: 15px; /* Increase height */
      }

      .progress-bar div {
        height: 100%;
      }

      /* Increase size of bottom controls */
      .controls {
        bottom: 10px;
        font-size: 30px; /* Increase font size for icons */
      }

      .controls button,
      .controls a {
        font-size: 70px; /* Increase font size for icons */
      }

      .controls button svg,
      .controls a svg {
        width: 35px; /* Set the desired width */
        height: 35px; /* Set the desired height */
      }

      /* Increase size of center controls */
      .center-controls {
        gap: 50px; /* Increase gap between buttons */
        top: 50%;
        bottom: 50%;
      }

      .center-controls button {
        font-size: 170px; /* Increase icon size */
      }

      .center-controls button i {
        font-size: 170px; /* Increase icon size */
      }

      .time {
        font-size: 50px;
      }
      
      #fullscreen {
        font-size: 70px;
      }

      /* Increase size of fullscreen controls */
      .fullscreen-left-controls button,
      .fullscreen-right-controls button {
        font-size: 30px; /* Increase font size for icons */
      }
    }
  </style>
</head>
<body>
  <div class="video-container" id="video-container">
    <video id="video" src="https://ia804603.us.archive.org/12/items/please-stand-by-video-effect_202409/SpongeBob%20SquarePants%20Season%201%20Episode%201%20Help%20Wanted%20%E2%80%93%20Reef%20Blower%20%E2%80%93%20Tea%20at%20the%20Treedome%20-%20SpongeBob%20SquarePants.mp4" type="video/mp4" data-poster="https://res.cloudinary.com/diuuelnkm/image/upload/v1737892949/Help_Wanted_title_card_ulypj1.jpg"></video>
    <!-- Add this inside the video-container div -->
    <div id="preview" class="preview"></div>
    <div id="preview-time" class="preview-time"></div>

    <!-- Error Message -->
    <div id="error-message" class="error-message hidden">
      <svg class="icon"><use xlink:href="icons-sprite.svg#playback-error"></use></svg>
      <p>This video cannot be played because of a problem with your internet connection.<br>(Error Code: 230002)</p>
    </div>

    <!-- Center Play Controls -->
    <div class="center-controls" id="center-controls">
      <button id="rewind"><svg class="icon"><use xlink:href="icons-sprite.svg#rewind-10"></use></svg>
    </button>
      <div class="loading-spinner" id="loading-spinner">
      </div>
      <button id="play-pause"><svg class="icon"><use xlink:href="icons-sprite.svg#play"></use></svg>
      </button>
      <button id="forward"><svg class="icon"><use xlink:href="icons-sprite.svg#skip-10"></use></svg>
   </button>
    </div>

    <!-- Progress Bar -->
    <div class="progress-bar" id="progress-bar">
      <div id="progress"></div>
    </div>

    <!-- Bottom Controls -->
    <div class="controls normal-controls">
      <button id="volume-toggle"><svg class="icon"><use xlink:href="icons-sprite.svg#volume-on"></use></svg>
      </button>
      <div class="time" id="time">00:00 / 00:00</div>
      <a id="download" download="video.mp4"><svg class="icon"><use xlink:href="icons-sprite.svg#download"></use></svg></a> <!-- Download button -->
      <button id="subtitles"><svg class="icon"><use xlink:href="icons-sprite.svg#captions-off"></use></svg></button> <!-- Subtitles button -->
      <button id="settings"><svg class="icon"><use xlink:href="icons-sprite.svg#settings"></use></svg></button>
      <button id="pip-toggle"><svg class="icon"><use xlink:href="icons-sprite.svg#pip"></use></svg></button> <!-- PiP button -->
      <button id="fullscreen"><svg class="icon"><use xlink:href="icons-sprite.svg#fullscreen"></use></svg></button>
    </div>

    <!-- Fullscreen Left Controls -->
    <div class="fullscreen-left-controls controls">
      <button id="volume-toggle-fullscreen"><svg class="icon"><use xlink:href="icons-sprite.svg#volume-on"></use></svg></button>
      <div class="time" id="time-fullscreen">00:00 / 00:00</div>
    </div>

    <!-- Fullscreen Right Controls -->
    <div class="fullscreen-right-controls controls">
      <a id="download-fullscreen" download="video.mp4"><svg class="icon"><use xlink:href="icons-sprite.svg#download"></use></svg></a>
      <button id="subtitles-fullscreen"><svg class="icon"><use xlink:href="icons-sprite.svg#captions-off"></use></svg></button> <!-- Subtitles button -->
      <button id="settings-fullscreen"><svg class="icon"><use xlink:href="icons-sprite.svg#settings"></use></svg></button>
      <button id="pip-toggle-fullscreen"><svg class="icon"><use xlink:href="icons-sprite.svg#pip"></use></svg></button> <!-- PiP button -->
      <button id="fullscreen-exit"><svg class="icon"><use xlink:href="icons-sprite.svg#fullscreen-exit"></use></svg></button>
    </div>

    <!-- Settings Menu -->
    <div class="settings-menu" id="settings-menu">
      <!-- Toolbar Header -->
      <div class="settings-header">
        <div style="text-align: center;">
        </div>
        <button class="active" data-tab="quality-tab"> <i class="bi bi-reception-4" style="font-size: 20px;"></i> </button>
        <button data-tab="captions-tab"> <i class="bi bi-cc-square" style="font-size: 20px;"></i> 
        </button>
        <button data-tab="speed-tab"> <span class="material-symbols-outlined" style="font-size: 20px;">acute</span> 
        </button>
        <span class="close-settings" id="close-settings"><span class="material-icons">close</span></span>
      </div>
      <!-- Content Area -->
      <div class="settings-body">
        <!-- Quality Options -->
        <ul id="quality-tab" class="settings-tab active-tab">
          <li data-quality="auto" class="selected">Auto</li>
          <li data-quality="1080p">1080p</li>
          <li data-quality="720p">720p</li>
          <li data-quality="480p">480p</li>
          <li data-quality="360p">360p</li>
          <li data-quality="240p">240p</li>
        </ul>
        <!-- Captions Options -->
        <ul id="captions-tab" class="settings-tab">
          <li data-caption="off" class="selected">Off</li>
          <li data-caption="english">English</li>
          <li data-caption="spanish">Spanish</li>
          <li data-caption="french">French</li>
        </ul>
        <!-- Speed Options -->
        <ul id="speed-tab" class="settings-tab">
          <li data-speed="0.5">0.5x</li>
          <li data-speed="1" class="selected">1x</li>
          <li data-speed="1.5">1.5x</li>
          <li data-speed="2">2x</li>
          <li data-speed="2.5">2.5x</li>
        </ul>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const video = document.getElementById('video');
      const playPauseButton = document.getElementById('play-pause');
      const rewindButton = document.getElementById('rewind');
      const forwardButton = document.getElementById('forward');
      const progressBar = document.getElementById('progress-bar');
      const progress = document.getElementById('progress');
      const fullscreenButton = document.getElementById('fullscreen');
      const fullscreenExitButton = document.getElementById('fullscreen-exit');
      const pipToggleButton = document.getElementById('pip-toggle');
      const pipToggleFullscreenButton = document.getElementById('pip-toggle-fullscreen');
      const timeDisplay = document.getElementById('time');
      const timeDisplayFullscreen = document.getElementById('time-fullscreen');
      const volumeToggleButton = document.getElementById('volume-toggle');
      const volumeToggleFullscreenButton = document.getElementById('volume-toggle-fullscreen');
      const downloadButton = document.getElementById('download');
      const downloadFullscreenButton = document.getElementById('download-fullscreen');
      const subtitlesButton = document.getElementById('subtitles');
      const subtitlesFullscreenButton = document.getElementById('subtitles-fullscreen');
      const videoContainer = document.getElementById('video-container');
      const settingsButton = document.getElementById('settings');
      const settingsFullscreenButton = document.getElementById('settings-fullscreen');
      const settingsMenu = document.getElementById('settings-menu');
      const closeSettingsButton = document.getElementById('close-settings');
      const loadingSpinner = document.getElementById('loading-spinner');
      const centerControls = document.getElementById('center-controls');
      const errorMessage = document.getElementById('error-message');
      const tabButtons = document.querySelectorAll('.settings-header button');
      const tabs = document.querySelectorAll('.settings-tab');
      const preview = document.getElementById('preview');
      const previewTime = document.getElementById('preview-time');


      // Array of preview image URLs
      const previewImages = [
        'https://s37o60krxrtmmx77.public.blob.vercel-storage.com/spongebob/thumb_001-8mJkdJK8PtAuDyGhXtQIHmBqcPQQ2U.png',
        'https://s37o60krxrtmmx77.public.blob.vercel-storage.com/spongebob/thumb_002-uzfoIz6nvtKnaYLcKPFO2zkxPwTweX.png',
        'https://s37o60krxrtmmx77.public.blob.vercel-storage.com/spongebob/thumb_003-iU2jbHJGNMGqtUuujWVTMN2GqepqV8.png',
        'https://s37o60krxrtmmx77.public.blob.vercel-storage.com/spongebob/thumb_004-eOgZmtE4z3uLrDCd2Sk6atWxLuJZLb.png',
        'https://s37o60krxrtmmx77.public.blob.vercel-storage.com/spongebob/thumb_005-coZc2ymrOJ7TwfVn6Id4gTEABb2hzI.png',
        'https://s37o60krxrtmmx77.public.blob.vercel-storage.com/spongebob/thumb_006-dbwJKr2tRDZyucwsBpEkaAOb1XW2Qx.png',
        'https://s37o60krxrtmmx77.public.blob.vercel-storage.com/spongebob/thumb_007-pn4iNYzzxFdKL5TBYhin0mtpQ8QuWD.png',
        'https://s37o60krxrtmmx77.public.blob.vercel-storage.com/spongebob/thumb_008-n2INvZKGJjlKU5T8ARwVSO5ovnrwTU.png'
      ];

      // Show preview on progress bar hover/move
      progressBar.addEventListener('mousemove', (event) => {
        updatePreview(event.clientX);
        showControls();
        hideCenterControls();
      });

      // Hide preview when not hovering over the progress bar
      progressBar.addEventListener('mouseleave', () => {
        preview.style.display = 'none';
        previewTime.style.display = 'none';
        hideControls();
        showCenterControls();
      });

      // Seek video when clicking on progress bar
      progressBar.addEventListener('click', (event) => {
        const rect = progressBar.getBoundingClientRect();
        const pos = (event.clientX - rect.left) / rect.width;
        video.currentTime = pos * video.duration;
        preview.style.display = 'none';
        previewTime.style.display = 'none';
        showControls();
      });

      // Variables to track touch interaction
      let isTouching = false;
      let initialTouchX = 0;
      let initialTime = 0;
      let wasPlaying = false;

      // Handle touch start on progress bar
      progressBar.addEventListener('touchstart', (event) => {
        isTouching = true;
        initialTouchX = event.touches[0].clientX;
        initialTime = video.currentTime;
        wasPlaying = !video.paused;
        video.pause();
        updateVideoTime(event.touches[0].clientX);
        showControls();
        hideCenterControls();
        clearTimeout(controlsTimeout); // Prevent hiding controls
      });

      // Handle touch move on progress bar
      progressBar.addEventListener('touchmove', (event) => {
        if (isTouching) {
          updateVideoTime(event.touches[0].clientX);
          showControls();
          hideCenterControls();
        }
      });

      // Handle touch end on progress bar
      progressBar.addEventListener('touchend', (event) => {
        isTouching = false;
        const rect = progressBar.getBoundingClientRect();
        const pos = (event.changedTouches[0].clientX - rect.left) / rect.width;
        video.currentTime = pos * video.duration;
        preview.style.display = 'none';
        previewTime.style.display = 'none';
        if (wasPlaying) {
          video.play();
        }
        controlsTimeout = setTimeout(hideControls, 3000); // Hide controls after timeout
        showCenterControls();
      });

      // Function to update the video time based on touch/mouse position
      function updateVideoTime(clientX) {
        const rect = progressBar.getBoundingClientRect();
        const pos = (clientX - rect.left) / rect.width;
        const newTime = pos * video.duration;

        // Update the progress bar width
        progress.style.width = `${pos * 100}%`;

        // Display and update the preview thumbnail
        updatePreviewThumbnail(newTime, clientX - rect.left);

        // Display and update the preview time
        updatePreviewTime(newTime, clientX - rect.left);
      }

      function updatePreviewThumbnail(time, clientX) {
        const previewIndex = Math.floor((time / video.duration) * previewImages.length);
        const previewImage = previewImages[previewIndex];

        // Display the preview thumbnail
        preview.style.backgroundImage = `url(${previewImage})`;
        preview.style.display = 'block';
        preview.style.left = `${clientX - preview.offsetWidth / 2}px`;
      }

      function updatePreviewTime(time, clientX) {
        const minutes = Math.floor(time / 60).toString().padStart(2, '0');
        const seconds = Math.floor(time % 60).toString().padStart(2, '0');
        const formattedTime = `${minutes}:${seconds}`;

        // Display the preview time
        previewTime.textContent = formattedTime;
        previewTime.style.display = 'block';
        previewTime.style.left = `${clientX - previewTime.offsetWidth / 2}px`;
      }

      // Function to hide the center controls
      function hideCenterControls() {
        centerControls.style.display = 'none';
      }

      // Function to show the center controls
      function showCenterControls() {
        if (!video.seeking && !video.waiting) {
          centerControls.style.display = 'flex';
        }
      }

      // Ensure elements exist before adding event listeners
      if (settingsButton) {
        settingsButton.addEventListener('click', () => {
          if (!controlsVisible) {
            showControls();
            return;
          }
          settingsMenu.style.display = settingsMenu.style.display === 'block' ? 'none' : 'block';
        });
      }

      if (settingsFullscreenButton) {
        settingsFullscreenButton.addEventListener('click', () => {
          if (!controlsVisible) {
            showControls();
            return;
          }
          settingsMenu.style.display = settingsMenu.style.display === 'block' ? 'none' : 'block';
        });
      }

      if (subtitlesButton) {
        subtitlesButton.addEventListener('click', () => {
          settingsMenu.style.display = 'block';
          document.querySelector('.settings-header button[data-tab="captions-tab"]').click();
        });
      }

      if (subtitlesFullscreenButton) {
        subtitlesFullscreenButton.addEventListener('click', () => {
          settingsMenu.style.display = 'block';
          document.querySelector('.settings-header button[data-tab="captions-tab"]').click();
        });
      }

      if (closeSettingsButton) {
        closeSettingsButton.addEventListener('click', () => {
          settingsMenu.style.display = 'none';
        });
      }

      tabButtons.forEach(button => {
        button.addEventListener('click', () => {
          tabButtons.forEach(btn => btn.classList.remove('active'));
          tabs.forEach(tab => tab.classList.remove('active-tab'));
          button.classList.add('active');
          document.getElementById(button.getAttribute('data-tab')).classList.add('active-tab');
        });
      });

function handleOptionSelection(selector, type) {
  const options = document.querySelectorAll(selector);
  options.forEach(option => {
    option.addEventListener('click', () => {
      options.forEach(opt => opt.classList.remove('selected'));
      option.classList.add('selected');
      console.log(`Selected ${type}:`, option.dataset[type]);

      if (type === 'speed') {
        video.playbackRate = parseFloat(option.dataset.speed);
      } else if (type === 'caption') {
        const subtitlesIcon = document.querySelector('#subtitles use');
        const subtitlesFullscreenIcon = document.querySelector('#subtitles-fullscreen use');
        if (option.dataset.caption === 'off') {
          subtitlesIcon.setAttribute('xlink:href', 'icons-sprite.svg#captions-off');
          subtitlesFullscreenIcon.setAttribute('xlink:href', 'icons-sprite.svg#captions-off');
        } else {
          subtitlesIcon.setAttribute('xlink:href', 'icons-sprite.svg#captions-on');
          subtitlesFullscreenIcon.setAttribute('xlink:href', 'icons-sprite.svg#captions-on');
        }
      }
    });
  });
}

      handleOptionSelection('#quality-tab li', 'quality');
      handleOptionSelection('#captions-tab li', 'caption');
      handleOptionSelection('#speed-tab li', 'speed');

      let controlsVisible = false;
      let controlsTimeout;
      let firstPlay = true;

      const lazyLoadPoster = (entries, observer) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const videoElement = entry.target;
            const posterUrl = videoElement.getAttribute('data-poster');
            videoElement.setAttribute('poster', posterUrl);
            observer.unobserve(videoElement);
          }
        });
      };

      const observer = new IntersectionObserver(lazyLoadPoster, {
        root: null,
        rootMargin: '0px',
        threshold: 0.1
      });

      observer.observe(video);

      const showControls = () => {
        videoContainer.classList.add('show-controls');
        centerControls.style.opacity = 1;
        controlsVisible = true;
        updateDownloadLink();
        clearTimeout(controlsTimeout);
        if (!video.paused && !isTouching && !video.waiting) {
          controlsTimeout = setTimeout(hideControls, 3000);
        }
      };

      const hideControls = () => {
        if (video.paused || isTouching || video.seeking || video.waiting) return;
        videoContainer.classList.remove('show-controls');
        centerControls.style.opacity = 0;
        controlsVisible = false;
        updateDownloadLink();
      };

      // Prevent right-click context menu
      document.addEventListener('contextmenu', function(event) {
        event.preventDefault();
      });

      // Prevent long-press context menu on touch devices
      document.addEventListener('touchstart', function(event) {
        event.preventDefault();
      });

      // Function to update the download link based on controls visibility
      const updateDownloadLink = () => {
        const downloadUrl = "https://streamtape.com/get_video?id=1O6YJGyDYwIeO2q&expires=1738379488&ip=GxAsDRMTKxSHDN&token=NAfysj8kfDL2&dl=1";
        if (controlsVisible) {
          downloadButton.href = downloadUrl;
          downloadFullscreenButton.href = downloadUrl;
        } else {
          downloadButton.removeAttribute('href');
          downloadFullscreenButton.removeAttribute('href');
        }
      };

      const detectDevTools = () => {
        const devtools = /./;
        devtools.toString = function () {
          debugger;
          return 'devtools';
        };
        console.log('%c', devtools);
      };

      setInterval(detectDevTools, 1000);

      videoContainer.addEventListener('click', (event) => {
        if (event.target.closest('.controls') || event.target.closest('.center-controls') || event.target.closest('.settings-menu')) {
          return;
        }
        if (controlsVisible) {
          hideControls();
        } else {
          showControls();
        }
      });

      if (video) {
        video.addEventListener('pause', () => {
          showControls();
          centerControls.style.opacity = 1;
          rewindButton.style.display = 'block';
          forwardButton.style.display = 'block';
        });

        video.addEventListener('play', () => {
          hideControls();
          rewindButton.style.display = 'block';
          forwardButton.style.display = 'block';
        });

        video.addEventListener('waiting', () => {
          loadingSpinner.style.display = 'block';
          playPauseButton.style.display = 'none';
          centerControls.style.display = 'flex'; // Ensure center controls are visible
          hideControls(); // Hide bottom controls
        });

        video.addEventListener('playing', () => {
          loadingSpinner.style.display = 'none';
          playPauseButton.style.display = 'block';
          centerControls.style.display = 'flex'; // Ensure center controls are visible
          showControls(); // Show bottom controls
        });

        video.addEventListener('timeupdate', () => {
          const currentTime = Math.floor(video.currentTime);
          const duration = Math.floor(video.duration);
          progress.style.width = `${(currentTime / duration) * 100}%`;

          const formatTime = (time) => {
            const minutes = Math.floor(time / 60).toString().padStart(2, '0');
            const seconds = (time % 60).toString().padStart(2, '0');
            return `${minutes}:${seconds}`;
          };
          timeDisplay.textContent = `${formatTime(currentTime)} / ${formatTime(duration)}`;
          timeDisplayFullscreen.textContent = `${formatTime(currentTime)} / ${formatTime(duration)}`;
        });

        video.addEventListener('error', () => {
          errorMessage.style.display = 'block';
        });

        video.addEventListener('play', () => {
          errorMessage.style.display = 'none';
        });
      }

  if (playPauseButton) {
    playPauseButton.addEventListener('click', (event) => {
      event.stopPropagation();
      if (firstPlay) {
        video.play();
        playPauseButton.innerHTML = '<svg class="icon"><use xlink:href="icons-sprite.svg#pause"></use></svg>';
        firstPlay = false;
      } else {
        if (!controlsVisible) {
          showControls();
        } else {
          if (video.paused) {
            video.play();
            playPauseButton.innerHTML ='<svg class="icon"><use xlink:href="icons-sprite.svg#pause"></use></svg>';
          } else {
            video.pause();
            playPauseButton.innerHTML = '<svg class="icon"><use xlink:href="icons-sprite.svg#play"></use></svg>';
          }
        }
      }
    });
  }

      if (rewindButton) {
        rewindButton.addEventListener('click', (event) => {
          if (!controlsVisible) {
            showControls();
            return;
          }
          event.stopPropagation();
          video.currentTime -= 10;
        });
      }

      if (forwardButton) {
        forwardButton.addEventListener('click', (event) => {
          if (!controlsVisible) {
            showControls();
            return;
          }
          event.stopPropagation();
          video.currentTime += 10;
        });
      }

      const toggleMute = () => {
        video.muted = !video.muted;
        const volumeIcon = video.muted ? '<svg class="icon"><use xlink:href="icons-sprite.svg#mute"></use></svg>' : '<svg class="icon"><use xlink:href="icons-sprite.svg#volume-on"></use></svg>';
        volumeToggleButton.innerHTML = volumeIcon;
        volumeToggleFullscreenButton.innerHTML = volumeIcon;
      };

      if (volumeToggleButton) {
        volumeToggleButton.addEventListener('click', (event) => {
          if (!controlsVisible) {
            showControls();
            return;
          }
          event.stopPropagation();
          toggleMute();
        });
      }

      if (volumeToggleFullscreenButton) {
        volumeToggleFullscreenButton.addEventListener('click', (event) => {
          if (!controlsVisible) {
            showControls();
            return;
          }
          event.stopPropagation();
          toggleMute();
        });
      }

      if (pipToggleButton) {
        pipToggleButton.addEventListener('click', async () => {
          if (!controlsVisible) {
            showControls();
            return;
          }
          try {
            if (document.pictureInPictureElement) {
              await document.exitPictureInPicture();
            } else {
              await video.requestPictureInPicture();
            }
          } catch (error) {
            console.log('Error with Picture-in-Picture:', error);
          }
        });
      }

      if (pipToggleFullscreenButton) {
        pipToggleFullscreenButton.addEventListener('click', async () => {
          if (!controlsVisible) {
            showControls();
            return;
          }
          try {
            if (document.pictureInPictureElement) {
              await document.exitPictureInPicture();
            } else {
              await video.requestPictureInPicture();
            }
          } catch (error) {
            console.log('Error with Picture-in-Picture:', error);
          }
        });
      }

      if (fullscreenButton) {
        fullscreenButton.addEventListener('click', (event) => {
          if (!controlsVisible) {
            showControls();
            return;
          }
          event.stopPropagation();
          if (!document.fullscreenElement) {
            enterFullscreen();
          } else {
            exitFullscreen();
          }
        });
      }

      if (fullscreenExitButton) {
        fullscreenExitButton.addEventListener('click', (event) => {
          if (!controlsVisible) {
            showControls();
            return;
          }
          event.stopPropagation();
          exitFullscreen();
        });
      }

      const enterFullscreen = () => {
        if (videoContainer.requestFullscreen) {
          videoContainer.requestFullscreen();
        } else if (videoContainer.mozRequestFullScreen) {
          videoContainer.mozRequestFullScreen();
        } else if (videoContainer.webkitRequestFullscreen) {
          videoContainer.webkitRequestFullscreen();
        } else if (videoContainer.msRequestFullscreen) {
          videoContainer.msRequestFullscreen();
        }

        if (screen.orientation && screen.orientation.lock) {
          screen.orientation.lock('landscape').catch(function (error) {
            console.log('Orientation lock failed: ', error);
          });
        }

        fullscreenButton.innerHTML = '<svg class="icon"><use xlink:href="icons-sprite.svg#fullscreen-exit"></use></svg>';
        fullscreenExitButton.innerHTML = '<svg class="icon"><use xlink:href="icons-sprite.svg#fullscreen-exit"></use></svg>';
      };

      const exitFullscreen = () => {
        if (document.exitFullscreen) {
          document.exitFullscreen();
        } else if (document.mozCancelFullScreen) {
          document.mozCancelFullScreen();
        } else if (document.webkitExitFullscreen) {
          document.webkitExitFullscreen();
        } else if (document.msExitFullscreen) {
          document.msExitFullscreen();
        }

        fullscreenButton.innerHTML = '<svg class="icon"><use xlink:href="icons-sprite.svg#fullscreen"></use></svg>';
      };

      document.addEventListener('fullscreenchange', function () {
        if (!document.fullscreenElement) {
          fullscreenButton.innerHTML = '<svg class="icon"><use xlink:href="icons-sprite.svg#fullscreen"></use></svg>';
        } else {
          fullscreenButton.innerHTML = '<svg class="icon"><use xlink:href="icons-sprite.svg#fullscreen"></use></svg>';
        }
      });

      if (centerControls) {
        centerControls.addEventListener('click', showControls);
      }

      if (progressBar) {
        progressBar.addEventListener('click', showControls);
      }

      document.querySelectorAll('.controls button').forEach(button => {
        button.addEventListener('click', showControls);
      });

      document.getElementById('video-container').addEventListener('contextmenu', (e) => {
        e.preventDefault();
      });

      let lastTapTime = 0;
      const DOUBLE_TAP_THRESHOLD = 300;

      if (videoContainer) {
        videoContainer.addEventListener('touchend', (e) => {
          const currentTime = Date.now();
          const tapPosition = e.changedTouches[0].clientX;
          const containerWidth = videoContainer.offsetWidth;

          // Disable double-tap to skip if settings menu is open
          if (settingsMenu.style.display === 'block') {
            return;
          }

          if (currentTime - lastTapTime < DOUBLE_TAP_THRESHOLD) {
            if (tapPosition < containerWidth / 2) {
              video.currentTime -= 10;
            } else {
              video.currentTime += 10;
            }
          }

          lastTapTime = currentTime;
        });
      }

      if (downloadButton) {
        downloadButton.addEventListener('click', (event) => {
          if (!controlsVisible) {
            showControls();
            event.preventDefault();
          }
        });
      }

      if (downloadFullscreenButton) {
        downloadFullscreenButton.addEventListener('click', (event) => {
          if (!controlsVisible) {
            showControls();
            event.preventDefault();
          }
        });
      }

      window.addEventListener('keydown', (event) => {
        if ((event.ctrlKey && event.shiftKey && event.key === 'I') ||
            (event.ctrlKey && event.shiftKey && event.key === 'J') ||
            (event.ctrlKey && event.key === 'U') ||
            (event.key === 'F12')) {
          event.preventDefault();
        }
      });

      function updatePreview(clientX) {
        const rect = progressBar.getBoundingClientRect();
        const pos = (clientX - rect.left) / rect.width;
        const previewTimeValue = pos * video.duration;

        // Display the preview thumbnail
        preview.style.display = 'block';
        preview.style.left = `${clientX - rect.left - preview.offsetWidth / 2}px`;

        const previewIndex = Math.floor((previewTimeValue / video.duration) * previewImages.length);
        const previewImage = previewImages[previewIndex];
        preview.style.backgroundImage = `url(${previewImage})`;

         // Display the preview time
        previewTime.textContent = formattedTime;
        previewTime.style.display = 'block';
        previewTime.style.left = `${clientX - previewTime.offsetWidth / 2}px`;
      }

      // Function to hide the center controls
      function hideCenterControls() {
        centerControls.style.display = 'none';
      }

      // Function to show the center controls
      function showCenterControls() {
        if (!video.seeking && !video.waiting) {
          centerControls.style.display = 'flex';
        }
      }

      // Ensure elements exist before adding event listeners
      if (settingsButton) {
        settingsButton.addEventListener('click', () => {
          if (!controlsVisible) {
            showControls();
            return;
          }
          settingsMenu.style.display = settingsMenu.style.display === 'block' ? 'none' : 'block';
        });
      }

      if (settingsFullscreenButton) {
        settingsFullscreenButton.addEventListener('click', () => {
          if (!controlsVisible) {
            showControls();
            return;
          }
          settingsMenu.style.display = settingsMenu.style.display === 'block' ? 'none' : 'block';
        });
      }

      if (subtitlesButton) {
        subtitlesButton.addEventListener('click', () => {
          settingsMenu.style.display = 'block';
          document.querySelector('.settings-header button[data-tab="captions-tab"]').click();
        });
      }

      if (subtitlesFullscreenButton) {
        subtitlesFullscreenButton.addEventListener('click', () => {
          settingsMenu.style.display = 'block';
          document.querySelector('.settings-header button[data-tab="captions-tab"]').click();
        });
      }

      if (closeSettingsButton) {
        closeSettingsButton.addEventListener('click', () => {
          settingsMenu.style.display = 'none';
        });
      }

      tabButtons.forEach(button => {
        button.addEventListener('click', () => {
          tabButtons.forEach(btn => btn.classList.remove('active'));
          tabs.forEach(tab => tab.classList.remove('active-tab'));
          button.classList.add('active');
          document.getElementById(button.getAttribute('data-tab')).classList.add('active-tab');
        });
      });

function handleOptionSelection(selector, type) {
  const options = document.querySelectorAll(selector);
  options.forEach(option => {
    option.addEventListener('click', () => {
      options.forEach(opt => opt.classList.remove('selected'));
      option.classList.add('selected');
      console.log(`Selected ${type}:`, option.dataset[type]);

      if (type === 'speed') {
        video.playbackRate = parseFloat(option.dataset.speed);
      } else if (type === 'caption') {
        const subtitlesIcon = document.querySelector('#subtitles use');
        const subtitlesFullscreenIcon = document.querySelector('#subtitles-fullscreen use');
        if (option.dataset.caption === 'off') {
          subtitlesIcon.setAttribute('xlink:href', 'icons-sprite.svg#captions-off');
          subtitlesFullscreenIcon.setAttribute('xlink:href', 'icons-sprite.svg#captions-off');
        } else {
          subtitlesIcon.setAttribute('xlink:href', 'icons-sprite.svg#captions-on');
          subtitlesFullscreenIcon.setAttribute('xlink:href', 'icons-sprite.svg#captions-on');
        }
      }
    });
  });
}

      handleOptionSelection('#quality-tab li', 'quality');
      handleOptionSelection('#captions-tab li', 'caption');
      handleOptionSelection('#speed-tab li', 'speed');

      let controlsVisible = false;
      let controlsTimeout;
      let firstPlay = true;

      const lazyLoadPoster = (entries, observer) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const videoElement = entry.target;
            const posterUrl = videoElement.getAttribute('data-poster');
            videoElement.setAttribute('poster', posterUrl);
            observer.unobserve(videoElement);
          }
        });
      };

      const observer = new IntersectionObserver(lazyLoadPoster, {
        root: null,
        rootMargin: '0px',
        threshold: 0.1
      });

      observer.observe(video);

      const showControls = () => {
        videoContainer.classList.add('show-controls');
        centerControls.style.opacity = 1;
        controlsVisible = true;
        updateDownloadLink();
        clearTimeout(controlsTimeout);
        if (!video.paused && !isTouching && !video.waiting) {
          controlsTimeout = setTimeout(hideControls, 3000);
        }
      };

      const hideControls = () => {
        if (video.paused || isTouching || video.seeking || video.waiting) return;
        videoContainer.classList.remove('show-controls');
        centerControls.style.opacity = 0;
        controlsVisible = false;
        updateDownloadLink();
      };

      // Prevent right-click context menu
      document.addEventListener('contextmenu', function(event) {
        event.preventDefault();
      });

      // Prevent long-press context menu on touch devices
      document.addEventListener('touchstart', function(event) {
        event.preventDefault();
      });

      // Function to update the download link based on controls visibility
      const updateDownloadLink = () => {
        const downloadUrl = "https://streamtape.com/get_video?id=1O6YJGyDYwIeO2q&expires=1738379488&ip=GxAsDRMTKxSHDN&token=NAfysj8kfDL2&dl=1";
        if (controlsVisible) {
          downloadButton.href = downloadUrl;
          downloadFullscreenButton.href = downloadUrl;
        } else {
          downloadButton.removeAttribute('href');
          downloadFullscreenButton.removeAttribute('href');
        }
      };

      const detectDevTools = () => {
        const devtools = /./;
        devtools.toString = function () {
          debugger;
          return 'devtools';
        };
        console.log('%c', devtools);
      };

      setInterval(detectDevTools, 1000);

      videoContainer.addEventListener('click', (event) => {
        if (event.target.closest('.controls') || event.target.closest('.center-controls') || event.target.closest('.settings-menu')) {
          return;
        }
        if (controlsVisible) {
          hideControls();
        } else {
          showControls();
        }
      });

      if (video) {
        video.addEventListener('pause', () => {
          showControls();
          centerControls.style.opacity = 1;
          rewindButton.style.display = 'block';
          forwardButton.style.display = 'block';
        });

        video.addEventListener('play', () => {
          hideControls();
          rewindButton.style.display = 'block';
          forwardButton.style.display = 'block';
        });

        video.addEventListener('waiting', () => {
          loadingSpinner.style.display = 'block';
          playPauseButton.style.display = 'none';
          centerControls.style.display = 'flex'; // Ensure center controls are visible
          hideControls(); // Hide bottom controls
        });

        video.addEventListener('playing', () => {
          loadingSpinner.style.display = 'none';
          playPauseButton.style.display = 'block';
          centerControls.style.display = 'flex'; // Ensure center controls are visible
          showControls(); // Show bottom controls
        });

        video.addEventListener('timeupdate', () => {
          const currentTime = Math.floor(video.currentTime);
          const duration = Math.floor(video.duration);
          progress.style.width = `${(currentTime / duration) * 100}%`;

          const formatTime = (time) => {
            const minutes = Math.floor(time / 60).toString().padStart(2, '0');
            const seconds = (time % 60).toString().padStart(2, '0');
            return `${minutes}:${seconds}`;
          };
          timeDisplay.textContent = `${formatTime(currentTime)} / ${formatTime(duration)}`;
          timeDisplayFullscreen.textContent = `${formatTime(currentTime)} / ${formatTime(duration)}`;
        });

        video.addEventListener('error', () => {
          errorMessage.style.display = 'block';
        });

        video.addEventListener('play', () => {
          errorMessage.style.display = 'none';
        });
      }

  if (playPauseButton) {
    playPauseButton.addEventListener('click', (event) => {
      event.stopPropagation();
      if (firstPlay) {
        video.play();
        playPauseButton.innerHTML = '<svg class="icon"><use xlink:href="icons-sprite.svg#pause"></use></svg>';
        firstPlay = false;
      } else {
        if (!controlsVisible) {
          showControls();
        } else {
          if (video.paused) {
            video.play();
            playPauseButton.innerHTML ='<svg class="icon"><use xlink:href="icons-sprite.svg#pause"></use></svg>';
          } else {
            video.pause();
            playPauseButton.innerHTML = '<svg class="icon"><use xlink:href="icons-sprite.svg#play"></use></svg>';
          }
        }
      }
    });
  }

      if (rewindButton) {
        rewindButton.addEventListener('click', (event) => {
          if (!controlsVisible) {
            showControls();
            return;
          }
          event.stopPropagation();
          video.currentTime -= 10;
        });
      }

      if (forwardButton) {
        forwardButton.addEventListener('click', (event) => {
          if (!controlsVisible) {
            showControls();
            return;
          }
          event.stopPropagation();
          video.currentTime += 10;
        });
      }

      const toggleMute = () => {
        video.muted = !video.muted;
        const volumeIcon = video.muted ? '<svg class="icon"><use xlink:href="icons-sprite.svg#mute"></use></svg>' : '<svg class="icon"><use xlink:href="icons-sprite.svg#volume-on"></use></svg>';
        volumeToggleButton.innerHTML = volumeIcon;
        volumeToggleFullscreenButton.innerHTML = volumeIcon;
      };

      if (volumeToggleButton) {
        volumeToggleButton.addEventListener('click', (event) => {
          if (!controlsVisible) {
            showControls();
            return;
          }
          event.stopPropagation();
          toggleMute();
        });
      }

      if (volumeToggleFullscreenButton) {
        volumeToggleFullscreenButton.addEventListener('click', (event) => {
          if (!controlsVisible) {
            showControls();
            return;
          }
          event.stopPropagation();
          toggleMute();
        });
      }

      if (pipToggleButton) {
        pipToggleButton.addEventListener('click', async () => {
          if (!controlsVisible) {
            showControls();
            return;
          }
          try {
            if (document.pictureInPictureElement) {
              await document.exitPictureInPicture();
            } else {
              await video.requestPictureInPicture();
            }
          } catch (error) {
            console.log('Error with Picture-in-Picture:', error);
          }
        });
      }

      if (pipToggleFullscreenButton) {
        pipToggleFullscreenButton.addEventListener('click', async () => {
          if (!controlsVisible) {
            showControls();
            return;
          }
          try {
            if (document.pictureInPictureElement) {
              await document.exitPictureInPicture();
            } else {
              await video.requestPictureInPicture();
            }
          } catch (error) {
            console.log('Error with Picture-in-Picture:', error);
          }
        });
      }

      if (fullscreenButton) {
        fullscreenButton.addEventListener('click', (event) => {
          if (!controlsVisible) {
            showControls();
            return;
          }
          event.stopPropagation();
          if (!document.fullscreenElement) {
            enterFullscreen();
          } else {
            exitFullscreen();
          }
        });
      }

      if (fullscreenExitButton) {
        fullscreenExitButton.addEventListener('click', (event) => {
          if (!controlsVisible) {
            showControls();
            return;
          }
          event.stopPropagation();
          exitFullscreen();
        });
      }

      const enterFullscreen = () => {
        if (videoContainer.requestFullscreen) {
          videoContainer.requestFullscreen();
        } else if (videoContainer.mozRequestFullScreen) {
          videoContainer.mozRequestFullScreen();
        } else if (videoContainer.webkitRequestFullscreen) {
          videoContainer.webkitRequestFullscreen();
        } else if (videoContainer.msRequestFullscreen) {
          videoContainer.msRequestFullscreen();
        }

        if (screen.orientation && screen.orientation.lock) {
          screen.orientation.lock('landscape').catch(function (error) {
            console.log('Orientation lock failed: ', error);
          });
        }

        fullscreenButton.innerHTML = '<svg class="icon"><use xlink:href="icons-sprite.svg#fullscreen-exit"></use></svg>';
        fullscreenExitButton.innerHTML = '<svg class="icon"><use xlink:href="icons-sprite.svg#fullscreen-exit"></use></svg>';
      };

      const exitFullscreen = () => {
        if (document.exitFullscreen) {
          document.exitFullscreen();
        } else if (document.mozCancelFullScreen) {
          document.mozCancelFullScreen();
        } else if (document.webkitExitFullscreen) {
          document.webkitExitFullscreen();
        } else if (document.msExitFullscreen) {
          document.msExitFullscreen();
        }

        fullscreenButton.innerHTML = '<svg class="icon"><use xlink:href="icons-sprite.svg#fullscreen"></use></svg>';
      };

      document.addEventListener('fullscreenchange', function () {
        if (!document.fullscreenElement) {
          fullscreenButton.innerHTML = '<svg class="icon"><use xlink:href="icons-sprite.svg#fullscreen"></use></svg>';
        } else {
          fullscreenButton.innerHTML = '<svg class="icon"><use xlink:href="icons-sprite.svg#fullscreen"></use></svg>';
        }
      });

      if (centerControls) {
        centerControls.addEventListener('click', showControls);
      }

      if (progressBar) {
        progressBar.addEventListener('click', showControls);
      }

      document.querySelectorAll('.controls button').forEach(button => {
        button.addEventListener('click', showControls);
      });

      document.getElementById('video-container').addEventListener('contextmenu', (e) => {
        e.preventDefault();
      });

      let lastTapTime = 0;
      const DOUBLE_TAP_THRESHOLD = 300;

      if (videoContainer) {
        videoContainer.addEventListener('touchend', (e) => {
          const currentTime = Date.now();
          const tapPosition = e.changedTouches[0].clientX;
          const containerWidth = videoContainer.offsetWidth;

          // Disable double-tap to skip if settings menu is open
          if (settingsMenu.style.display === 'block') {
            return;
          }

          if (currentTime - lastTapTime < DOUBLE_TAP_THRESHOLD) {
            if (tapPosition < containerWidth / 2) {
              video.currentTime -= 10;
            } else {
              video.currentTime += 10;
            }
          }

          lastTapTime = currentTime;
        });
      }

      if (downloadButton) {
        downloadButton.addEventListener('click', (event) => {
          if (!controlsVisible) {
            showControls();
            event.preventDefault();
          }
        });
      }

      if (downloadFullscreenButton) {
        downloadFullscreenButton.addEventListener('click', (event) => {
          if (!controlsVisible) {
            showControls();
            event.preventDefault();
          }
        });
      }

      window.addEventListener('keydown', (event) => {
        if ((event.ctrlKey && event.shiftKey && event.key === 'I') ||
            (event.ctrlKey && event.shiftKey && event.key === 'J') ||
            (event.ctrlKey && event.key === 'U') ||
            (event.key === 'F12')) {
          event.preventDefault();
        }
      });

      function updatePreview(clientX) {
        const rect = progressBar.getBoundingClientRect();
        const pos = (clientX - rect.left) / rect.width;
        const previewTimeValue = pos * video.duration;

        // Display the preview thumbnail
        preview.style.display = 'block';
        preview.style.left = `${clientX - rect.left - preview.offsetWidth / 2}px`;

        const previewIndex = Math.floor((previewTimeValue / video.duration) * previewImages.length);
        const previewImage = previewImages[previewIndex];
        preview.style.backgroundImage = `url(${previewImage})`;

        // Display the preview time
        const minutes = Math.floor(previewTimeValue / 60).toString().padStart(2, '0');
        const seconds = Math.floor(previewTimeValue % 60).toString().padStart(2, '0');
        const formattedTime = `${minutes}:${seconds}`;
        previewTime.textContent = formattedTime;
        previewTime.style.display = 'block';
        previewTime.style.left = `${clientX - previewTime.offsetWidth / 2}px`;
      }
    });
  </script>
</body>
</html>
